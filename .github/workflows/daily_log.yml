name: Daily Notion Log

on:
  schedule:
    # 每天北京时间 04:00 运行 (UTC 20:00)
    # 注意：UTC 20:00 是前一天的，但我们的 Python 脚本里加了 8小时时区处理，
    # 只要保证脚本运行时已经是新的一天即可。
    # 建议设为 UTC 20:00 (北京时间 凌晨4点) 或者 UTC 00:00 (北京时间 上午8点)
    - cron: '0 0 * * *' 
  workflow_dispatch: # 允许手动点击按钮触发测试

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install notion-client python-dotenv retrying pytz

    - name: Run automation
      env:
        # 这里引用 GitHub Secrets
        NOTION_TOKEN: ${{ secrets.NOTION_TOKEN }}
        NOTION_PAGE: ${{ secrets.NOTION_PAGE }}
        # 如果你的数据库名字不一样，可以在这里覆盖
        # DAY_DATABASE_NAME: "日"
        # WEEK_DATABASE_NAME: "周"
      run: python main.py
